文章来源: CDC [原文地址](https://mp.weixin.qq.com/s/lva_OQgf_IpXqKgR4Szlww)

> _**[引言]**_
>
> 腾讯CDC的此次**「 云游敦煌 」**小程序设计过程中, 我们可以看到从项目最开始的方案构思, 到设计部分的规范与产出效果. 从中既可以看见流程, 也可以看见技术和细节.

## 流程

需求识别. <产品设计与开发> 一书中提到, 需求识别的目的, 是了解用户的需求, 以及对用户的需求进行加工, 生成真正的需求, 并在团队内形成统一的认识.

获取需求的方法包括了**访谈法**和 **焦点小组法**, 这里 CDC 团队使用了 焦点小组法, 焦点小组访谈需要注意的是, 人员需要多类, 需要有领先用户, 也需要有极端用户和普通用户.

## 理解

敦煌窟, 因为其历史原因, 有许多历史细节及技艺还在被不断的发掘出来, 敦煌, 是一片需要我们去探究的隐秘之地.

理解敦煌, 能使得将敦煌呈现出来的时候不会让人感觉有脱节.

CDC团队首先注重一点, 敦煌的壁画, 不是纸, 是墙.

![](https://pic3.zhimg.com/80/v2-e4ba195ba4a41156f74edce1fa584942_1440w.jpg)

## 设计规范

- 圆角弧度

- 阴影

- 颗粒感

  ![](https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2020%2F0403%2Fafe1afe1p00q87jal00ecd200u000eag00zk00gx.png&thumbnail=650x2147483647&quality=80&type=jpg)

- 图标

- 字体

- **标识**: 在需求识别截断, CDC团队获取了当下用户对敦煌的认识, 从而确定了团队在设计APP时, 首先应该表现出哪些元素符号与用户形成共鸣.

  ![](https://mmbiz.qpic.cn/mmbiz_png/DKcPurxib9LxxxzjGqRAMGOHTCrHDTvpk2jYflP5sxEmh63VN6UqTmDMTYtnSceyiaUaexpYK9FAt4lJb0ohOr5w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

- 色彩

## 色彩

> 色彩是本篇CDC文章的重点. 上面有提到过, 敦煌的颜色是石头, 是矿物颜色. 本人有幸参加过**千佛洞美术馆**筹划的敦煌壁画展览, 虽然说是敦煌壁画, 但其实他们仅仅是取敦煌的噱头, 其本意是想借敦煌来向世人介绍**高昌**, 不过这些都不是本篇的内容罢了. 

> 那会儿在壁画展前, 看着哪些矿物颜料,和CDC一样,都惊呆了.

> 人工合成的颜料, B站上凤舞九天[色彩重铸系列](https://space.bilibili.com/865267)非常推荐去看一看.

敦煌的传统颜料主要起源于**当地矿石、进口宝石及部分人工合成的颜料。**迄今约有千百年的历史。

### 取色

CDC团队向敦煌研究院咨询比较象征敦煌的颜色, 从岩壁颜料的十一管色阶中, 取出了中间三管的颜色, 使用**Color.review**去验证**颜色在屏幕色彩对比度上的合理性**. 

那么壁画和色库如何关联起来呢，我们设定的策略是**「壁画中若含有一个与指定颜色符合接近范围的颜色，视为匹配成功。一幅壁画可以和多个指定的颜色关联」**

### **从壁画里解剖颜色**

壁画留载千年，存在众多破损和杂色痕迹，这种情况下就会面临一个废色过多，色彩分布零散的问题。我们都知道一幅画中有很多颜色，哪个颜色才算数，是面积大的颜色吗？这会导致，很多壁画都是其大面积的颜色被检测到，这是不够的。**我们需要解剖出壁画中那些突出的颜色**，于是我们做了如下尝试：

**· 通过划分明度分离颜色**
我们发现老旧的敦煌壁画，许多突出的颜色已经变淡。我们将壁画划分三种层次的明度，将突出的颜色重新在各个明度分层里面解剖出来。这样解剖出来的颜色就更加全面。

**· 聚类颜色**
初步解剖出第一批颜色之后，为了让颜色后续被更有序地被拾取，我们需将这批颜色进行打理。通过设定颜色之间相似度的范围，对颜色进行聚类。

**· 杂色过滤**
通过聚类颜色之后 ， 需要进一步将杂色过滤掉。我们将明度和饱和度来同时过滤，为得到的颜色设立明度等级及在每级明度下设立饱和度范围，一级级将不合范围的无效色过滤掉。

**· 设置排序**
如果将敦煌壁画划分为高中低三个明度，我们发现，权重的颜色主要集中在中等明度，我们将最后得到的颜色结果按明度优先级去排序，得到最终的解剖色。

### **将解剖的颜色与色库匹配**

> 关于HSV与RGB的关系, 可以看[这篇文章](https://blog.csdn.net/m0_37192554/article/details/82012532). HSV模型对应于画家配色的方法.

实现了壁画的颜色解剖，就要进行颜色匹配了。我们有大量的壁画需要和色库匹配，因此需要设定一个自动匹配的机制。在技术上，我们选用**H（色调）、S（饱和度）、V（明度） 模式**作为颜色模式。**HSV 模式**下的色彩可以视为一个圆锥立体模型， **H**是0°～360°的顶部圆面，不同的角度代表着不同的色调倾向。**S**是圆面上的直径，每单位长度的直径代表着该长度下相应饱和度的色调。**V**对应的是圆锥的中间轴，代表明度。

![图片](https://www.leaxr.com/pluginfile.php/3606/mod_resource/content/1/Chroma.jpg)

基于圆锥立体模型的几何概念，建立该模型**（x,y,z）**三维坐标的算法。在斜边长**R**，底面圆半径为**r**，高为**h**的**HSV**圆锥体内，以地面圆心为原点，**H=0**为**x**轴正方向建立坐标轴。那么色值是**（H,S,V）**的点的三维坐标**（x,y,z）**是

![图片](https://mmbiz.qpic.cn/mmbiz_png/DKcPurxib9LxxxzjGqRAMGOHTCrHDTvpk0d1fzG9WZIFm7ps9BIqImLQDWEKUHCzMeqCVcqbkb7sSTiaVCnUuQSw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

如此一来，所有的颜色都可以通过坐标计算得出在立体圆锥里的位置。通过以下几步就可实现颜色与壁画的自动匹配。

- 确认指定颜色，如密陀僧在圆锥中的坐标是**A**。
- 将所有壁画的颜色解剖，并将解剖的颜色投入圆锥中，通过以上算法得出所有颜色的具体坐标位置。
- 遍历所有颜色在圆锥中与坐标A距离
- 设定与坐标**A**距离的排名范围，取与坐标A距离最近的前排颜色。
- 则这批颜色所属壁画就成功匹配为属于密陀僧的壁画。

在小程序中技术只是连接观众与敦煌石窟的桥梁，我们希望送到大家眼前的，是触手可及的敦煌岩彩展，壁画展。虽然过程会遇到一些困难，尤其是从颜色探索壁画，相比一般的图像取色，从老旧的敦煌壁画解剖出原本的颜色会更困难。在进行明度划分的时候，看到不同明度下的颜色块面被一层层分离，仿佛感受到壁画中的一层层物件被重新唤醒。

## 后记

看文章吧, 颜色部分已经抄过来了, 后记还是尊重一下原文吧. 这真的是一篇很优秀的文章.

看到这个颜色数据库, 让我想到有一次参加Google IO大会的**[Google文化与艺术项目](https://artsandculture.google.com/?hl=zh-CN)**, 与敦煌不同, 也有相同之处.

相同的是, **Google文艺**和**云游敦煌**都是艺术博物馆的线上展示的实现方案, 不同的是, Google呈现的是全世界的博物馆艺术品, 种类繁多, 数据量大. 而敦煌的特点是壁画, 颜色和各类文化符号.

我记得Google文艺项目也有一个利用大数据手段, 使用户可以查看相似艺术品的设计, 还有一个大数据地图, 根据博物展品的颜色, 将所有数字化展品聚类, 这点上和云游敦煌是非常相似的.